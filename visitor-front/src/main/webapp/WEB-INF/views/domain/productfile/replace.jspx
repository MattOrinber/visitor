<html xmlns:util="urn:jsptagdir:/WEB-INF/tags/util" xmlns:jsp="http://java.sun.com/JSP/Page" 
xmlns:decorator="http://www.opensymphony.com/sitemesh/decorator" xmlns:c="http://java.sun.com/jsp/jstl/core" 
xmlns:form="http://www.springframework.org/tags/form" xmlns:security="http://www.springframework.org/security/tags" 
xmlns:spring="http://www.springframework.org/tags" version="2.0">
<jsp:output omit-xml-declaration="yes" />
<jsp:directive.page contentType="text/html; charset=UTF-8" />
<head>
	<title><spring:message code="productFile" />: <spring:message code="crud.functionalities.create" /></title>
	<script type="text/javascript">
		function validate(){
			var regInst = /^.*?\.(apk|jar|sis|sisx|APK|JAR|SIS|SISX)$/; 
			var regJad = /^.*?\.(jad|JAD)$/; 
			if($("#jarFile").val().length &lt; 1 &amp;&amp; $("#filePathLabel").val().length &lt; 1){
				alert("安装文件不能为空");
				return false;
			}
			
			if(!regInst.test($("#jarFile").val())){
				alert("安装文件格式错误");
				return false;
			}
			
			if($("#jadFile").val().length &gt; 0){
				if(!regJad.test($("#jadFile").val())){
					alert("JAD文件后缀名必须为jad");
					return false;
				}
			}
		}
	</script>

</head>
<body>
	<a href="${pageContext.request.contextPath}/domain/productlist/show/${productFile.product.primaryKey}"
		class="ajaxy button button-search"><spring:message code="productList" />
	</a>
	
	<span class="ui-state-highlight button button-create"><spring:message code="crud.functionalities.create" /> </span>
	<form:form action="${pageContext.request.contextPath}/domain/productfile/replace/${productFile.primaryKey}"
		modelAttribute="productFile" method="POST"
		enctype="multipart/form-data" onsubmit="return validate()">
		<table class="create">
			<tbody>
				<tr>
					<th></th>
					<td>
						<c:if test="${msg!=null}">
							<c:forEach items="${msg}" var="obj">
								<span id="errors" class="error">${obj }</span>
							</c:forEach>
						</c:if>
					</td>
				</tr>
				
				<tr>
					<th><spring:message code="productFile_filePath" /> <em></em></th>
					<td>
						<input type="hidden" id="fileId" name="file" value="${file}" />
						<input type="text" id="filePathLabel" value="${productFile.filePath}" size="100" />
						<script>
						$(function() {
							$("#filePathLabel").autocomplete('destroy');
							$("#filePathLabel").autocomplete({
								source: "${pageContext.request.contextPath}/domain/productfile/autoproductfile?pid=${productFile.product.primaryKey}",
								select: function(event, ui) {
									$("#fileId").val(ui.item.id);
									$("#filePathLabel").val(ui.item.label);
								}
							});
						});
						</script>
						<form:errors path="filePath" cssClass="error"/>
					</td>
				</tr>

				<tr>
					<th>
						<spring:message code="productFile_install" />
					</th>
					<td>
						<!-- 安装文件 -->
						<input type="file" name="jarFile" id="jarFile" />
						<br />
						<spring:message code="productFile_install_intro" />
					</td>
				</tr>
				<tr>
					<th>
						<spring:message code="productFile_jad" />
					</th>
					<td>
						<!-- JAD文件 -->
						<input type="file" name="jadFile" id="jadFile" />
					</td>
				</tr>
			</tbody>
			<tfoot>
				<tr>
					<td colspan="2">
						<spring:message code="crud.save.button" var="saveButton"/>
						<input type="submit" class="button button-save" value="${saveButton}" />
					</td>
				</tr>
			</tfoot>
		</table>

	</form:form>

</body>
</html>