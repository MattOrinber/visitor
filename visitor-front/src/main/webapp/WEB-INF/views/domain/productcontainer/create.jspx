<html xmlns:util="urn:jsptagdir:/WEB-INF/tags/util" xmlns:jsp="http://java.sun.com/JSP/Page" xmlns:decorator="http://www.opensymphony.com/sitemesh/decorator" xmlns:c="http://java.sun.com/jsp/jstl/core"  xmlns:fmt="http://java.sun.com/jsp/jstl/fmt" xmlns:form="http://www.springframework.org/tags/form" xmlns:security="http://www.springframework.org/security/tags" xmlns:spring="http://www.springframework.org/tags">

<jsp:output omit-xml-declaration="yes" />
<jsp:directive.page contentType="text/html; charset=UTF-8" />
<head>
	<title><spring:message code="productContainer" />: <spring:message code="crud.functionalities.create" />
	</title>
	<script type="text/javascript">
	$(function() {
		$("#folderId")
				.change(
						function() {
							var siteId = $(this).val();
							$
									.ajax( {
										type : "GET",
										url : "${pageContext.request.contextPath}/domain/pagecontainer/autopageList/" + siteId,
										success : function(ss) {
											var arr = eval(ss);
											cleanSelect(document
													.getElementById("pageId"));
											cleanSelect(document
													.getElementById("containerId"));
											freshSelect(document
													.getElementById("pageId"),
													arr);
										}
									})
						});
		
		$("#pageId")
				.change(
						function() {
							var siteId = $(this).val();
							var currSiteId = $("#siteId").val();
							$
									.ajax( {
										type : "GET",
										url : "${pageContext.request.contextPath}/domain/pagecontainer/containerList/"
												+ siteId + "/" + currSiteId,
										success : function(ss) {
											var arr = eval(ss);
											cleanSelect(document
													.getElementById("containerId"));
											freshSelect(
													document
															.getElementById("containerId"),
													arr);
										}
									})
						});
		
	})
	function cleanSelect(selectObj) {
		var count = selectObj.options.length;
		for ( var i = count - 1; i &gt;= 0; i--) {
			selectObj.options[i] = null;
		}
		selectObj.options.add(new Option("<spring:message code='button_select' />", ""));
	}
	function freshSelect(selectObj, arr) {
		for ( var i = 0; i &lt; arr.length; i++) {
			selectObj.options.add(new Option(arr[i].key, arr[i].value));
		}
	}
	
	function check(){
		
		if($("#folderId").val()==""){
			alert("请选择频道！");
			return false;
		}else if($("#pageId").val()==""){
			alert("请选择页面！");
			return false;
		}else if($("#containerId").val()==""){
			alert("请选择容器！");
			return false;
		}
		
		return true;
	}
</script>
</head>
<body>
	<c:if test="${productContainer.type==1}">
		<a href="${pageContext.request.contextPath}/domain/productlist/show/${product_id}"
			class="ajaxy button button-search">
			<fmt:message key="productList" /> 
		</a>
	</c:if>
	<c:if test="${productContainer.type==2}">
		<a href="${pageContext.request.contextPath}/domain/folder/show/${product_id}"
			class="ajaxy button button-search">
			<fmt:message key="folder" /> 
		</a>
	</c:if>
	<c:if test="${productContainer.type==3}">
		<a href="${pageContext.request.contextPath}/domain/advertise/show/${product_id}"
			class="ajaxy button button-search">
			<fmt:message key="advertise" /> 
		</a>
	</c:if>
			
			
	<span class="ui-state-highlight button button-create"><fmt:message
			key="crud.functionalities.create" /> </span>
	<form:form
		action="${pageContext.request.contextPath}/domain/productcontainer/create"
		modelAttribute="productContainer" method="POST" onsubmit="return check()">
		
		<form:hidden path="productContainerId" />
		<form:hidden path="type"/>
		<form:hidden path="siteId" />
		
		<input type="hidden" id="pid" name="pid" value="${product_id}" />
		<!-- 表单 -->
		<table class="create">
			<tbody>
				<tr>
				<td><form:errors cssClass="error" /></td>
				</tr>
				<tr>
					<th>
						<spring:message code="productList_productId" />
					</th>
					<td>${product_id}</td>
				</tr>
				<tr>
					<th>
						<spring:message code="productList_name" />
					</th>
					<td>${productList.name}</td>
				</tr>
				<!--产品类型-->
				<tr>
					<th>
						<spring:message code="productContainer_type" />
					</th>
					<td>
						<c:if test="${productContainer.type==1}"><spring:message code="productContainer_type_Book" /></c:if>
						<c:if test="${productContainer.type==2}"><spring:message code="productContainer_type_Folder" /></c:if>
						<c:if test="${productContainer.type==3}"><spring:message code="productContainer_type_Advertise" /></c:if>
					</td>
				</tr>
				<tr>
					<th>
						<spring:message code="productContainer_folder" />
						<em>*</em>
					</th>
					<td>
						<!-- 频道 -->
						<span id="folderSpan"> <form:select path="folderId">
								<form:option value=""><spring:message code='button_select' /></form:option>
								<form:options items="${folderMap}"  />
							</form:select> </span>
						<form:errors path="folderId" cssClass="error" />
					</td>
				</tr>
				<tr>
					<th>
						<spring:message code="productContainer_page" />
						<em>*</em>
					</th>
					<td>
						<!-- 页面 -->
						<form:select path="pageId">
							<form:option value=""><spring:message code='button_select' /></form:option>
						</form:select>
						<form:errors path="pageId" cssClass="error" />
					</td>
				</tr>
				<tr>
					<th>
						<spring:message code="productContainer_container" />
						<em>*</em>
					</th>
					<td>
						<!-- 容器 -->
						<form:select path="containerId">
							<form:option value=""><spring:message code='button_select' /></form:option>
						</form:select>
						<form:errors path="containerId" cssClass="error" />
					</td>
				</tr>
			</tbody>
			<tfoot>
				<tr>
					<td colspan="2">
						<spring:message code="crud.save.button" var="btnMsg" />
						<input type="submit" class="button button-save" value="${btnMsg}" />
					</td>
				</tr>
			</tfoot>
		</table>
	</form:form>
</body>
</html>