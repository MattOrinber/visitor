<html xmlns:util="urn:jsptagdir:/WEB-INF/tags/util" xmlns:jsp="http://java.sun.com/JSP/Page" 
xmlns:decorator="http://www.opensymphony.com/sitemesh/decorator" xmlns:c="http://java.sun.com/jsp/jstl/core" 
xmlns:form="http://www.springframework.org/tags/form" xmlns:security="http://www.springframework.org/security/tags" 
xmlns:spring="http://www.springframework.org/tags" version="2.0">
<jsp:output omit-xml-declaration="yes" />
<jsp:directive.page contentType="text/html; charset=UTF-8" />
<head>
	<title><spring:message code="folder" />: <spring:message code="crud.functionalities.list" /></title>
	
	<spring:theme code="themePackage" var="themePackage" />
	<spring:theme code="scriptPackage" var="scriptPackage" />
	
	<spring:url value="/${themePackage}" var="themePackageUrl" />
	<spring:url value="/${scriptPackage}" var="scriptPackageUrl" />
	
	<link rel="stylesheet" href="${themePackageUrl}/plugins/tree/jquery.treeview.css" type="text/css" media="screen, projection" />
	<script type="text/javascript" src="${scriptPackageUrl}/jquery-1.5.2/jquery.cookie.js"><c:out value=" " /></script>
	<script type="text/javascript" src="${scriptPackageUrl}/jquery-ui-1.8.11/tree/jquery.treeview.js"><c:out value=" " /></script>
	<script type="text/javascript">
	$(document).ready(function() {
		setTree();
		activeFolderInfo();
	});

	function setTree() {
		$("#folder_tree").treeview( {
			collapsed : true,
			animated : "medium",
			control : "#sidetreecontrol",
			persist : "location"
		});
	}
	
		function activeFolderInfo(){
			$("span[node]").click(function(){
				var folder = $("#folder_right");
				folder.hide().load("${pageContext.request.contextPath}/domain/folder/show/" + $(this).attr("node") + " #folder_result" ,
					function() {
						setupPage();
						$(this).fadeIn();
				});
			});
		}
	</script>
</head>
<body>
	<a href="${pageContext.request.contextPath}/domain/folder/search" class="ajaxy button button-search"><spring:message code="folder" /></a>
	<a href="${pageContext.request.contextPath}/domain/folder/create" class="button button-create"><spring:message code="crud.functionalities.create" /></a>
	<span class="ui-state-highlight button"><spring:message code="folder_site_nodes" /></span> 
	<table class="show">
		<tbody>
			<tr>
				<td>
					<div id="folder_left" style="float:left;width:170px;">
						<ul id="folder_tree">
							<c:forEach items="${siteTree}" var="siteNode">
								<li>
									<span>${siteNode.site.name}</span>
									<c:if test="${siteNode.folders != null}">
										<ul>
											<c:forEach items="${siteNode.folders}" var="folderNode">
												<c:set var="node" value="${folderNode}" scope="request"/>
												<jsp:include page="/WEB-INF/views/domain/folder/treenode.jspx" />
											</c:forEach>
										</ul>
									</c:if>
								</li>
							</c:forEach>
						</ul>
					</div>
					<div id="folder_right" style="float:right;width:950px;">
										
					</div>
				</td>
			</tr>
		</tbody>
	</table>
</body>
</html>