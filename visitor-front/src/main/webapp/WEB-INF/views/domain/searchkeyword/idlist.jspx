<html xmlns:util="urn:jsptagdir:/WEB-INF/tags/util" xmlns:jsp="http://java.sun.com/JSP/Page" 
xmlns:decorator="http://www.opensymphony.com/sitemesh/decorator" xmlns:c="http://java.sun.com/jsp/jstl/core" 
xmlns:form="http://www.springframework.org/tags/form" xmlns:security="http://www.springframework.org/security/tags" 
xmlns:spring="http://www.springframework.org/tags" version="2.0">
<jsp:output omit-xml-declaration="yes" />
<jsp:directive.page contentType="text/html; charset=UTF-8" />
<head>
	<title><spring:message code="searchKeyword" />: <spring:message code="searchKeyword_idlist" /></title>
	<script type="text/javascript">
		$(document).ready(function() {
			$("#sort").click(function(){
				$( "#sort_area" ).show();
				$( "#cover_body" ).css({width:$(document).width(),height:$(document).height()}).show();
			});
			
			$("#sort_save").click(function(){
				var productIdrs = $("#sortable").sortable('toArray');
				
				$.ajax( {
					type : "GET",
					url : "${pageContext.request.contextPath}/domain/searchkeyword/sort/${search.primaryKey}/" + productIdrs,
					success : function(ss) {
						if(ss){
							/*refreash current page*/
							window.document.location.href="${pageContext.request.contextPath}/domain/searchkeyword/idlist/${search.primaryKey}";
						}
					}
				})
			});
			
			$("#sort_cancel").click(function(){
				$( "#sort_area" ).hide();
				$( "#cover_body" ).hide();
			});
			
			$( "#sortable" ).sortable();
			$( "#sortable" ).sortable('option', 'axis', 'y');
			$( "#sortable" ).sortable('option', 'opacity', 0.5);
			$( "#sortable" ).sortable('option', 'revert', true);
			$( "#sortable" ).sortable('option', 'items', 'li');
		});
	</script>
	<script type="text/javascript">
		function deleteCheck(){
			var itemIds=document.getElementsByName("itemIds");
			
			var count=0;
			var ids="";
			for(var i=0;i &lt; itemIds.length;i++){
				if(itemIds[i].checked){
					count++;
					ids= ids + itemIds[i].value + "_";
				}
			}
			
			if(count==0){
				alert("请至少选择一条记录！");
			}else{
				if(confirm("您真的要删除多条记录吗？")){
				
					ids = ids.substring(0,ids.length-1);
					var url = "${pageContext.request.contextPath}/domain/searchkeyword/deleteitem/${search.keywordId}/" + ids;
					window.location = url;
				}
			}
		}
		
		function changeCheckState(check_style){
			var itemIds=document.getElementsByName("itemIds");
			
			var count=0;
			var ids="";
			
			var checked = true;
			if(check_style=="1"){
				checked = false;
			}
			
			for(var i=0;i &lt; itemIds.length;i++){
				if(itemIds[i].checked == checked){
					itemIds[i].checked = !checked;
				}
			}	
		}
	</script>
	<STYLE>
		#sortable { list-style-type: none; margin: 0; padding: 0; width: 100%; }
		#sortable li { cursor: move; margin: 0 3px 3px 3px; padding : 0.1em 0.4em 0.5em 1.0em; font-size: 1.0em; height: 16px; border: 1px solid #AAAAAA; border-radius: 4px 4px 4px 4px;}
		.btnSpace {
			margin-right:10px;
		}
	</STYLE>
</head>
<body>
	<a href="${pageContext.request.contextPath}/domain/searchkeyword/search" class="ajaxy button button-search"><spring:message code="searchKeyword" /></a>
	<a href="${pageContext.request.contextPath}/domain/searchkeyword/show/${searchKeyword.primaryKey}" class="button button-show"><spring:message code="crud.show.button" /></a>
	<a href="${pageContext.request.contextPath}/domain/searchkeyword/update/${searchKeyword.primaryKey}" class="ajaxy button button-edit"><spring:message code="crud.edit.button" /></a>
	<a href="${pageContext.request.contextPath}/domain/searchkeyword/delete/${searchKeyword.primaryKey}" class="modal button button-delete"><spring:message code="crud.delete.button" /></a>
	<span class="ui-state-highlight button button-show"><spring:message code="searchKeyword_idlist" /></span>
	<a href="${pageContext.request.contextPath}/domain/init/redis/searchkeyword?siteId=${searchKeyword.siteId}&amp;keywordId=${searchKeyword.primaryKey}" class="modal button"><spring:message code="crud.redis.publish.button" /></a>

	<!--show form ,to edit the id list -->
	<c:if test="${search.wordKind!=0}">
		<form:form action="${pageContext.request.contextPath}/domain/searchkeyword/updateids/${search.primaryKey}" modelAttribute="searchKeyword" method="POST">
			<table class="show">
				<tbody>
					<tr>
						<th><spring:message code="searchKeyword_name" /></th>
						<td><spring:eval expression="search.name"/></td>
					</tr>
					<tr>
						<th><spring:message code="searchKeyword_wordKind" /></th>
						<c:if test="${search.wordKind == 1}">
							<td><spring:message code="searchKeyword_prd" /></td>
						</c:if>
						<c:if test="${search.wordKind == 2}">
							<td><spring:message code="searchKeyword_fld" /></td>
						</c:if>
						<c:if test="${search.wordKind == 3}">
							<td><spring:message code="searchKeyword_adv" /></td>
						</c:if>
					</tr>
					<tr>
						<th><spring:message code="searchKeyword_ids" /></th>
						<td><form:input path="idList" cssClass="{maxlength: 200;}" cssStyle="margin-right:10px" size="50px"/>
							<form:errors path="idList" cssClass="error"/>
							
							<spring:message code="crud.save.button" var="btnMsg" />
							<input type="submit" class="button button-save" value="${btnMsg}" />&amp;nbsp;&amp;nbsp;
							
							<c:set var="urlName" value="productlist" />
							<c:if test="${search.wordKind == 1}">
								<a href="${pageContext.request.contextPath}/domain/searchkeyword/selectprd?kyid=${search.primaryKey}" class="button">
									<spring:message code="searchKeyword_id_prd" />
								</a>
							</c:if>
							
							<c:if test="${search.wordKind == 2}">
								<a href="${pageContext.request.contextPath}/domain/searchkeyword/selectfld?kyid=${search.primaryKey}" class="button">
									<spring:message code="searchKeyword_id_fld" />
								</a>
								<c:set var="urlName" value="folder" />
							</c:if>
							
							<c:if test="${search.wordKind == 3}">
								<a href="${pageContext.request.contextPath}/domain/searchkeyword/selectadv?kyid=${search.primaryKey}" class="button">
									<spring:message code="searchKeyword_id_adv" />
									
								</a>
								<c:set var="urlName" value="advertise" />
							</c:if>
							
						</td>
					</tr>
				</tbody>	
			</table>
		</form:form>
	</c:if>
	<!--show id list code begin-->
	<div id="result">
		<c:if test="${itemList!=null}">
			<table class="edit">
				<thead>
					<tr>
						<th style="width:10%"><spring:message code="searchKeyword_check" /></th>
						<th style="width:10%"><spring:message code="searchKeyword_sort_order" /></th>						
						<th style="width:10%"><spring:message code="searchKeyword_id" /></th>
						<th style="width:35%"><spring:message code="searchKeyword_name" /></th>
						<th style="width:35%"><spring:message code="searchKeyword_op" /></th>
					</tr>
				</thead>
				<tbody>
					<c:forEach items="${itemList}" var="item" varStatus="status">
						<tr>
							<td><input type="checkbox" name="itemIds" value="${item.id}" /></td>
							<td>${status.index + 1}</td>
							<td>${item.id}</td>
							<td>
								<a href="${pageContext.request.contextPath}/domain/${urlName}/show/${item.id}">${item.name}</a>
							</td>
							<td>
								<a href="${pageContext.request.contextPath}/domain/searchkeyword/deleteitem/${search.keywordId}/${item.id}" class="button button-delete"><spring:message code="crud.delete.button"/></a>
							</td>
						</tr>
					</c:forEach>
				</tbody>
				<tfoot>
					<tr>
						<td colspan="5">
							<a onclick="changeCheckState(1)" class="button btnSpace"><spring:message code="button_select_all"/></a>
							<a onclick="changeCheckState(0)" class="button btnSpace"><spring:message code="button_select_none"/></a>    
							<a onclick="deleteCheck()" class="button button-delete btnSpace"><spring:message code="button_deletesel"/></a>
							<a id="sort" href="#" class="ajaxy button"><spring:message code="crud.sort.button" /></a>
						</td>
					</tr>
				</tfoot>
			</table>
			<!--sortable div-->
			<div id="sort_area" class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable ui-resizable" style="display: none; z-index: 1002; outline: 0px none; position: absolute; height: auto; width: 300px; top: 120px; left: 478px;">
				<div class="ui-dialog-content" style="width: auto; min-height: 102.267px; height: auto;">
					<div>
						<ul id="sortable">
							<c:forEach items="${itemList}" var="item" varStatus="status">
								<li id="${item.id}" class="ui-state-default">${item.name}</li>
							</c:forEach>
						</ul>
					</div>
					<div style="padding-left: 5.5em;">
						<spring:message code="crud.save.button" var="saveButton"/>
						<input id="sort_save" type="button" class="button" value="${saveButton}"/>
						<spring:message code="crud.cancel.button" var="sortButton"/>
						<input id="sort_cancel" type="button" class="button" value="${sortButton}"/>
					</div>
				</div>
			</div>
			<!--sortable div -end-->
			<div id="cover_body" class="ui-widget-overlay" style="display:none; z-index: 1001;"></div>
		</c:if>
		<c:if test="${itemList == null}">
			<spring:message code="searchKeyword_no_result" />
		</c:if>
	</div>
	<!--show id list code end-->	
</body>
</html>