<html xmlns:util="urn:jsptagdir:/WEB-INF/tags/util" xmlns:jsp="http://java.sun.com/JSP/Page" 
xmlns:decorator="http://www.opensymphony.com/sitemesh/decorator" xmlns:c="http://java.sun.com/jsp/jstl/core" 
xmlns:form="http://www.springframework.org/tags/form" xmlns:security="http://www.springframework.org/security/tags" 
xmlns:spring="http://www.springframework.org/tags" version="2.0">
<jsp:output omit-xml-declaration="yes" />
<jsp:directive.page contentType="text/html; charset=UTF-8" />
<head>
	<spring:theme code="themePackage" var="themePackage" />
	<spring:theme code="scriptPackage" var="scriptPackage" />
	
	<spring:url value="/${themePackage}" var="themePackageUrl" />
	<spring:url value="/${scriptPackage}" var="scriptPackageUrl" />
	
	<title><spring:message code="category" />: <spring:message code="crud.functionalities.list" /></title>
	<link rel="stylesheet" href="${themePackageUrl}/plugins/tree/jquery.treeview.css" type="text/css" media="screen, projection" />
	<script type="text/javascript" src="${scriptPackageUrl}/jquery-1.5.2/jquery.cookie.js"><c:out value=" " /></script>
	<script type="text/javascript" src="${scriptPackageUrl}/jquery-ui-1.8.11/tree/jquery.treeview.js"><c:out value=" " /></script>
	<script type="text/javascript">
		$(document).ready(function() {
			setTree();
			activeFolderInfo();
		});
		
		function setTree() {
			$("#category_tree").treeview({
				collapsed: true,
				animated: "medium",
				control: "#sidetreecontrol",
				persist: "location"
			});
		}
		function activeFolderInfo(){
			$("span[node]").click(function(){
				var folder = $("#category_right");
				folder.hide().load("${pageContext.request.contextPath}/domain/category/update/" + $(this).attr("node") + " #category" ,
					function() {
						setupPage();
						$(this).fadeIn();
				});
			});
		}		
		function validate(){
			var cname = $.trim($("input[name='name']").val());
			if(cname.length &lt; 1){
				alert("名称不能为空");
				return false;
			}
			if(cname.length &gt; 200){
				alert("名字长度不能超过200字符");
				return false;
			}
			
			cname = $.trim($("input[name='sortOrder']").val());
			if(cname.length &lt; 1){
				alert("排序不能为空");
				return false;
			}	
			
			var name = $.trim($("input[name='name']").val());
			var enname = $.trim($("input[name='enName']").val());
			var thread = $.trim($("input[name='thread']").val());
			var parentId = $.trim($("input[name='parentCategory']").val());
			var flag =true;
			
			$.ajax( {
				type : "GET",
				async : false,
				url : "${pageContext.request.contextPath}/domain/rest/category/validreply?thread="+thread+"&amp;parentid="+parentId+"&amp;name="+name+"&amp;enname="+enname,
				success : function(ss) {
					var err = eval(ss);
					if(err.err != null){
						alert(err.err);
						 flag=false;
					}
				}
			})
			
			return flag;
		}
		
		function openInDiv(url,divid,event){
			var category = $("#category_right");
			event.preventDefault();
			event.stopPropagation();
			category.load(url + " #"+divid);
			return;
		}
	</script>
</head>
<body>
	<table class="show">
		<tbody>
			<tr>
				<td>
					<div id="dis_category_value">
						<div id="category_left" style="float:left;">
							<ul id="category_tree">
								<c:forEach items="${categoryNodes}" var="folderNode">
									<c:set var="node" value="${folderNode}" scope="request"/>
									<jsp:include page="/WEB-INF/views/domain/category/treenode.jspx" />
								</c:forEach>
							</ul>
						</div>
						<div id="category_right" style="float:right;width:750px;">
							<a href="#" onclick="openInDiv('${pageContext.request.contextPath}/domain/category/createChild/${category.primaryKey}','create',event)" class="ajaxy button button-create"><spring:message code="crud.functionalities.create" /></a>
						</div>
					</div>
					<div id="dis_site_info"></div>
				</td>
			</tr>
		</tbody>
	</table>
</body>
</html>