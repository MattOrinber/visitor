<html xmlns:util="urn:jsptagdir:/WEB-INF/tags/util" xmlns:jsp="http://java.sun.com/JSP/Page" 
xmlns:decorator="http://www.opensymphony.com/sitemesh/decorator" xmlns:c="http://java.sun.com/jsp/jstl/core" 
xmlns:form="http://www.springframework.org/tags/form" xmlns:security="http://www.springframework.org/security/tags" 
xmlns:spring="http://www.springframework.org/tags" version="2.0">
<jsp:output omit-xml-declaration="yes" />
<jsp:directive.page contentType="text/html; charset=UTF-8" />
<head>
	<title><spring:message code="advertise" />: <spring:message code="crud.functionalities.create" />
	</title>
	<script type="text/javascript">
		function validate(){
			if($('input:radio[name="pictureSize"]:checked').val() == 0){
				/*var reg = /^.*?\.(jpg|png|gif|JPG|PNG|GIF)$/; 
				if(!reg.test($("#pic").val())){
					alert("广告图后缀名必须为jpg/png/gif");
					return false;
				}*/
			}else{
				if($('input:checkbox[name="waterMarkIds"]:checked').val() == null){
					alert("请选择水印图片");
					return false;
				}
			}
			
			/**检查字段的有效性*/
			var checkedId = $("input:radio[name='type']:checked").val();
			if(checkedId == 0){
				if($("#url").val()==""){
					alert("请输入URL地址！");
					return false;
				}
			}else if(checkedId == 1){
				if($("#folderId").val()==""){
					alert("请输入频道ID！");
					return false;
				}				
			}else {
				if($("#productId").val()==""){
					alert("请输入产品ID！");
					return false;
				}								
			}			
			
			return true;
		}
		
		$(document).ready(function() {
		
			$("#type1").click(function(){
				showTypeUrl();
			});
			
			$("#type2").click(function(){
				showFolderId();
			});
			
			$("#type3").click(function(){
				showProductId();
			});
			
			$("#pictureSize_0").click(function(){
				showPictureUpload();
			});
			
			$("#pictureSize_1").click(function(){
				showPictureWaterMark();
			});
			
			$("#pictureSize_2").click(function(){
				showPictureWaterMark();
			});
			
			
			if($('input:radio[name="type"]:checked').val() == 0){
				$("#type1").click();
			}
			if($('input:radio[name="type"]:checked').val() == 1){
				$("#type2").click();
			}
			if($('input:radio[name="type"]:checked').val() == 2){
				$("#type3").click();
			}
		});
		
		function showTypeUrl(){
			$("#th_typeUrl").show();
			$("#td_typeUrl").show();
			$("#th_folderId").hide();
			$("#td_folderId").hide();
			$("#th_productId").hide();
			$("#td_productId").hide();
			$("#div_pictureSize").hide();
			$("#pictureSize_0").click();
		}
		
		function showFolderId(){
			$("#th_typeUrl").hide();
			$("#td_typeUrl").hide();
			$("#th_folderId").show();
			$("#td_folderId").show();
			$("#th_productId").hide();
			$("#td_productId").hide();
			$("#div_pictureSize").hide();
			$("#pictureSize_0").click();
		}
		
		function showProductId(){
			$("#th_typeUrl").hide();
			$("#td_typeUrl").hide();
			$("#th_folderId").hide();
			$("#td_folderId").hide();
			$("#th_productId").show();
			$("#td_productId").show();
			$("#div_pictureSize").show();
			$("#pictureSize_0").click();
		}
		
		function showPictureUpload(){
			$("#div_advertise_pic").show();
			$("#div_watermark").hide();
		}
		
		function showPictureWaterMark(){
			$("#div_advertise_pic").hide();
			$("#div_watermark").show();
		}
		
	</script>
</head>
<body>
	<a href="${pageContext.request.contextPath}/domain/advertise/search"
		class="ajaxy button button-search"><spring:message code="advertise" />
	</a>
	<span class="ui-state-highlight button button-create"><spring:message code="crud.functionalities.create" />
	</span>
	<form:form action="${pageContext.request.contextPath}/domain/advertise/create"
		modelAttribute="advertise" method="POST" enctype="multipart/form-data" onsubmit="return validate()" >
		<form:errors cssClass="error" />
		<form:hidden path="advertiseId" />
		<table class="create">
			<tbody>
				<!--广告类型-->
				<tr>
					<th>
						<spring:message code="advertise_type" />
						<em>*</em>
					</th>
					<td>
						<form:radiobutton path="type" value="0" checked="checked"/><spring:message code="advertise_typeUrl" />
						<form:radiobutton path="type" value="1"/><spring:message code="advertise_typeFolder" />
						<form:radiobutton path="type" value="2"/><spring:message code="advertise_typeProduct" />
						<form:errors path="type" cssClass="error" />
					</td>
				</tr>
				<tr>
					<!--合作URL-->
						<th id="th_typeUrl">
							<spring:message code="advertise_typeUrl" />
							<em>*</em>
						</th>
						<td id="td_typeUrl">
							<form:input path="url" maxlength="100" size="60" />
							<form:errors path="url" cssClass="error" />
						</td>
						<!--频道ID-->
						<th id="th_folderId">
							<spring:message code="advertise_folderId" />
							<em>*</em>
						</th>
						<td id="td_folderId">
							<form:input path="folderId" cssClass="number" />
							<form:errors path="folderId" cssClass="error" />
						</td>
						<!--产品ID-->
						<th id="th_productId">
							<spring:message code="advertise_productId" />
							<em>*</em>
						</th>
						<td id="td_productId">
							<form:input path="productId" cssClass="number" />
							<form:errors path="productId" cssClass="error" />
						</td>
				</tr>
				<!--广告名-->
				<tr>
					<th>
						<spring:message code="advertise_name" />
						<em>*</em>
					</th>
					<td>
						<form:input path="name" cssClass="required {maxlength: 200}" maxlength="200" size="60" />
						<form:errors path="name" cssClass="error" />
					</td>
				</tr>
				<!--广告图-->
				<tr>
					<th>
						<spring:message code="advertise_picture" />
						<em>*</em>
					</th>
					<td>
						<div id="div_pictureSize">
							<input type="radio" id="pictureSize_0" name="pictureSize" value="0" checked="checked"/><spring:message code="advertise_picture_type_0" />
							<input type="radio" id="pictureSize_1" name="pictureSize" value="72"/><spring:message code="advertise_picture_type_1" />
							<input type="radio" id="pictureSize_2" name="pictureSize" value="78"/><spring:message code="advertise_picture_type_2" />
						</div>
						<div id="div_watermark" style="display:none">
							<br/>
							<table>
								<tr>
									<c:forEach items="${waterMarkList}" var="waterMark" varStatus="_st">
										<td>
										<label for="waterMark_${_st.index}"><img src="${picDomain}${waterMark.path}" height="60" width="60" /></label><br/>
										<input type="checkbox" name="waterMarkIds" id="waterMark_${_st.index}" value="${waterMark.pictureId}"/>
										<label for="waterMark_${_st.index}">${waterMark.name}</label>
										</td>
									</c:forEach>
								</tr>
							</table>
						</div>
						<div id="div_advertise_pic">
							<div id="advertise_pic" style="display:none;"><img src="/" height="36" width="36" /></div>
							<spring:eval expression="advertise.pictureId" javaScriptEscape="true" var="picName"/>
							<input type="hidden" id="pic" name="pictureId" value="${picName}" />
							<input type="text" id="picLabel" value="${advertise.picture.name}" size="60" />
							<script>
							$(function() {
								$("#picLabel").autocomplete('destroy');
								$("#picLabel").autocomplete({
									source: "${pageContext.request.contextPath}/domain/picture/autocomplete/2",
									select: function(event, ui) {
										$("#pic").val(ui.item.id);
										$("#picLabel").val(ui.item.label);
										var path = ui.item.label;
										path = "/" +path.substring(path.indexOf('/'));
										$("#advertise_pic").show().children().attr("src","${picDomain}"+path);
									}
								});
							});
							</script>
							<form:errors path="pictureId" cssClass="error" />
						</div>
					</td>
				</tr>
				<!--描述-->
				<tr>
					<th>
						<spring:message code="advertise_description" />
					</th>
					<td>
						<form:input path="description" cssClass="{maxlength: 1024}" maxlength="1024" size="60" />
						<form:errors path="description" cssClass="error" />
					</td>
				</tr>

				<!--广告ICON-->
				<tr id="tr_icon">
					<th>
						<spring:message code="advertise_icon" />
					</th>
					<td>
						<div id="advertise_pic_icon" style="display:none;"><img src="/" height="36" width="36" /></div>
						<spring:eval expression="advertise.iconId" javaScriptEscape="true" var="picIconName"/>
						<input type="hidden" id="pic_icon" name="iconId" value="${picIconName}" />
						<input type="text" id="picLabel_icon" value="${advertise.icon.name}" size="60" />
						<script>
						$(function() {
							$("#picLabel_icon").autocomplete('destroy');
							$("#picLabel_icon").autocomplete({
								source: "${pageContext.request.contextPath}/domain/picture/autocomplete/2",
								select: function(event, ui) {
									$("#pic_icon").val(ui.item.id);
									$("#picLabel_icon").val(ui.item.label);
									var path = ui.item.label;
									path = "/" +path.substring(path.indexOf('/'));
									$("#advertise_pic_icon").show().children().attr("src","${picDomain}"+path);
								}
							});
						});
						</script>
						<form:errors path="iconId" cssClass="error" />
					</td>
				</tr>
			</tbody>
			<tfoot>
				<tr>
					<td colspan="2">
						<spring:message code="crud.save.button" var="saveButton"/>
						<input type="submit" class="button button-save"	value="${saveButton}" />
					</td>
				</tr>
			</tfoot>
		</table>
	</form:form>
</body>
</html>