<html xmlns:util="urn:jsptagdir:/WEB-INF/tags/util" xmlns:jsp="http://java.sun.com/JSP/Page" 
xmlns:decorator="http://www.opensymphony.com/sitemesh/decorator" xmlns:c="http://java.sun.com/jsp/jstl/core" 
xmlns:form="http://www.springframework.org/tags/form" xmlns:security="http://www.springframework.org/security/tags" 
xmlns:spring="http://www.springframework.org/tags" version="2.0">
<jsp:output omit-xml-declaration="yes" />
<jsp:directive.page contentType="text/html; charset=UTF-8" />
<head>
	<title><spring:message code="productFile" />: <spring:message code="crud.functionalities.create" /></title>
	
	<script type="text/javascript">
		
		function validate(){
			var regInst = /^.*?\.(apk|jar|sis|sisx|APK|JAR|SIS|SISX)$/; 
			var regJad = /^.*?\.(jad|JAD)$/;
			if($("#os").val().length &lt; 1 &amp;&amp; $("#osLabel").val().length &lt; 1){
				alert("操作系统不能为空");
				return false;
			}
			
			if($("#platform").val().length &lt; 1 &amp;&amp; $("#platformLabel").val().length &lt; 1){
				alert("平台不能为空");
				return false;
			}
			
			if($("#resolution").val().length &lt; 1 &amp;&amp; $("#resolutionLabel").val().length &lt; 1){
				alert("分辨率不能为空");
				return false;
			}
			
			if($("#jarFile").val().length &lt; 1 &amp;&amp; $("#filePathLabel").val().length &lt; 1){
				alert("安装文件不能为空");
				return false;
			}
			
			if(!regInst.test($("#jarFile").val())){
				alert("安装文件格式错误");
				return false;
			}
			
			if($("#jadFile").val().length &gt; 0){
				if(!regJad.test($("#jadFile").val())){
					alert("JAD文件后缀名必须为jad");
					return false;
				}
			}
		}
	</script>
	
</head>
<body>
	<a href="${pageContext.request.contextPath}/domain/productlist/show/${productList.productId}" class="ajaxy button button-search"><spring:message code="productList" /></a>
	<span class="ui-state-highlight button button-create"><spring:message code="crud.functionalities.create" /></span>
	<form:form action="${pageContext.request.contextPath}/domain/productfile/create" modelAttribute="productFileSearchForm" method="POST" enctype="multipart/form-data" onsubmit="return validate()" cssClass="create">
		<form:errors cssClass="error"/>
		<input type="hidden" name="pid" value="${productList.productId}" />
		<table class="create">
			<tbody>
				<tr>
					<th><spring:message code="productFile_product" /> </th>
					<td>
						<spring:eval expression="productList.name" javaScriptEscape="true"/>
					</td>
				</tr>
				<tr>
					<th><spring:message code="productFile_fileDisName" /></th>
					<td>
						<form:input path="productFile.fileDisName" cssClass="{maxlength: 100}" maxlength="100" size="100"/>
					</td>
				</tr>
				<tr>
					<th><spring:message code="productFile_filePath" /></th>
					<td>
						<input type="hidden" id="fileId" name="fileId" value="${fileId}" />
						<input type="text" id="filePathLabel" value="${productFile.filePath}" size="60" />
						<script>
						$(function() {
							$("#filePathLabel").autocomplete('destroy');
							$("#filePathLabel").autocomplete({
								source: "${pageContext.request.contextPath}/domain/productfile/autoproductfile?pid=${productList.productId}",
								select: function(event, ui) {
									$("#fileId").val(ui.item.id);
									$("#filePathLabel").val(ui.item.label);
								}
							});
						});
						</script>
						<form:errors path="productFile.filePath" cssClass="error"/>
					</td>
				</tr>
				<tr>
					<th><spring:message code="productFile_fileUrl" /> <em></em></th>
					<td>
						<form:input path="productFile.fileUrl" cssClass="{maxlength: 255}" maxlength="255" size="60"/> <font color="red"><spring:message code="productFile_fileUrl_infro" /></font>
					</td>
				</tr>
				<tr>
					<th><spring:message code="productFile_os" /> <em>*</em></th>
					<td>
						<input type="hidden" id="os" name="productFile.osId" value="${productFileSearchForm.productFile.osId}" />
						<input type="text" id="osLabel" value="${productFileSearchForm.productFile.os}" size="30" class="required" />
						<script>
						$(function() {
							$("#osLabel").autocomplete('destroy');
							$("#osLabel").autocomplete({
								source: "${pageContext.request.contextPath}/domain/category/childcategory?categoryId=3",
								select: function(event, ui) {
									$("#os").val(ui.item.id);
									$("#osLabel").val(ui.item.label);
									setPlatform(ui.item.id);
									$("form").validate();
								}
							});
						});
						</script>
						<form:errors path="productFile.osId" cssClass="error"/>
					</td>
				</tr>
				<tr>
					<th><spring:message code="productFile_platform" /> <em>*</em></th>
					<td>
						<input type="hidden" id="platform" name="productFile.platformId" value="${productFileSearchForm.productFile.platformId}" />
						<input type="text" id="platformLabel" value="${productFileSearchForm.productFile.platform}" size="30" class="required" />
						<script>
						function setPlatform(osId) {
							$("#platformLabel").autocomplete('destroy');
							$("#platformLabel").autocomplete({
								source: "${pageContext.request.contextPath}/domain/category/childcategory?categoryId=" + osId,
								select: function(event, ui) {
									$("#platform").val(ui.item.id);
									$("#platformLabel").val(ui.item.label);
									setPlatformVersion(ui.item.id);
								}
							});
						}
						</script>
						<form:errors path="productFile.platformId" cssClass="error"/>
					</td>
				</tr>
				<tr>
					<th><spring:message code="productFile_platformVersion" /></th>
					<td>
						<select name="productFile.versionOperator">
							<option value=""/>
							<option value="0"/><spring:message code="productFile_platformVersion_operator_ge" />
							<option value="1"/><spring:message code="productFile_platformVersion_operator_eq" />
							<option value="2"/><spring:message code="productFile_platformVersion_operator_le" />
						</select>
						<input type="hidden" id="platformVersion" name="productFile.platformVersionId" value="${productFileSearchForm.productFile.platformVersionId}" />
						<input type="text" id="platformVersionLabel" value="${productFileSearchForm.productFile.platformVersion}" size="18" />
						<script>
						function setPlatformVersion(platformId) {
							$("#platformVersionLabel").autocomplete('destroy');
							$("#platformVersionLabel").autocomplete({
								source: "${pageContext.request.contextPath}/domain/category/childcategory?categoryId=" + platformId,
								select: function(event, ui) {
									$("#platformVersion").val(ui.item.id);
									$("#platformVersionLabel").val(ui.item.label);
								}
							});
						}
						</script>
						<form:errors path="productFile.platformVersionId" cssClass="error"/>
					</td>
				</tr>
				<tr>
					<th><spring:message code="productFile_resolution" /><em>*</em></th>
					<td>
						<input type="hidden" id="resolution" name="productFile.resolutionId" value="${productFileSearchForm.productFile.resolutionId}" />
						<input type="text" id="resolutionLabel" value="${productFileSearchForm.productFile.resolution}" size="30" class="required" />
						<script>
						$(function() {
							$("#resolutionLabel").autocomplete('destroy');
							$("#resolutionLabel").autocomplete({
								source: "${pageContext.request.contextPath}/domain/category/childcategory?categoryId=5",
								select: function(event, ui) {
									$("#resolution").val(ui.item.id);
									$("#resolutionLabel").val(ui.item.label);
								}
							});
						});
						</script>
						<form:errors path="productFile.resolution" cssClass="error"/>
					</td>
				</tr>
				<tr>
					<th>
						<spring:message code="productFile_install" />
						<em>*</em>
					</th>
					<td>
						<!-- 安装文件 -->
						<input type="file" name="jarFile" id="jarFile" class="required" />
						<br />
						<spring:message code="productFile_install_intro" />
					</td>
				</tr>
				<tr>
					<th>
						<spring:message code="productFile_jad" />
					</th>
					<td>
						<!-- JAD文件 -->
						<input type="file" name="jadFile" id="jadFile" />
					</td>
				</tr>
				<tr>
					<th><spring:message code="productFile_ifDefaultFile" /></th>
					<td>
						<form:radiobutton path="productFile.ifDefaultFile" value="0" /><spring:message code="TRUE" />
						<form:radiobutton path="productFile.ifDefaultFile" value="1" checked="checked"/><spring:message code="FALSE" />
						<form:errors path="productFile.ifDefaultFile" cssClass="error"/>
					</td>
				</tr>
				<tr>
					<th>
						<spring:message code="productFile_safeType" />
					</th>
					<td>
						<form:select path="productFile.safeType" items="${safeTypeList}" itemValue="value" itemLabel="name" disabled="true" />
						<form:errors path="productFile.safeType" cssClass="error" />
					</td>
				</tr>
				<tr>
					<th>
						<spring:message code="productFile_autoScan" />
					</th>
					<td>
						<form:radiobutton path="productFile.autoScan" value="0" checked="checked" disabled="true"/><spring:message code="OPEN" />
						<form:radiobutton path="productFile.autoScan" value="1" disabled="true"/><spring:message code="CLOSE" />
						<form:errors path="productFile.autoScan" cssClass="error" />
					</td>
				</tr>
			</tbody>
			<tfoot>
				<tr>
					<td colspan="2">
						<spring:message code="crud.save.button" var="saveButton"/>
						<input type="submit" class="button button-save" value="${saveButton}"/>
					</td>
				</tr>
			</tfoot>
		</table>
	</form:form>
</body>
</html>