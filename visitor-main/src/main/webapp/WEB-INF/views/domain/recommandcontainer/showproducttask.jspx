<html xmlns:util="urn:jsptagdir:/WEB-INF/tags/util" xmlns:jsp="http://java.sun.com/JSP/Page" xmlns:decorator="http://www.opensymphony.com/sitemesh/decorator" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fmt="http://java.sun.com/jsp/jstl/fmt" xmlns:form="http://www.springframework.org/tags/form" xmlns:security="http://www.springframework.org/security/tags" xmlns:spring="http://www.springframework.org/tags">

<jsp:output omit-xml-declaration="yes" />
<jsp:directive.page contentType="text/html; charset=UTF-8" />

<head>
	<title><spring:message code="recommandContainer" />: <spring:message code="productContainerTask" /></title>
	<script type="text/javascript">
		$(document).ready(function() {
			$(".sortclass").click(function(){
				var theDate = $(this).attr("id").substring(4);
				
				//清除UL里的元素
				$("#sortable li").remove();
				//依次添加对应表格里面的内容
				var sortUl=$("#sortable");
				$("#tb"+theDate+" tr:gt(1)").each(function() {
					var taskid = $(this).children().eq(5);
					var pname = $(this).children().eq(1);
					if (taskid.text().trim() != '') {
						var $li_1 = $("&lt;li id='"+taskid.text().trim()+"' class='ui-state-default'&gt;"+pname.next().text().trim()+"&lt;/li&gt;");
						sortUl.append($li_1);
					}
				 });
						
				$( "#sort_area" ).show();
				$( "#cover_body" ).css({width:$(document).width(),height:$(document).height()}).show();
				
			});	
			
			$(".addclass").click(function(){
				var theDate = $(this).attr("id").substring(3);
				$("#showDate").text(theDate.substring(0,4)+"年"+theDate.substring(4,6)+"月"+theDate.substring(6)+"日");	
				$("#addCurrDate").val(theDate);
				
				$( "#add_area" ).show();
				$( "#cover_body" ).css({width:$(document).width(),height:$(document).height()}).show();
				
			});	

			$(".updateclass").click(function(){
				
				var theId = $(this).attr("id").substring(3);
				var thePrex = $(this).attr("id").substring(0,3);
				
				if(thePrex == "prd"){
					$("#showType").text("产品");
					$("#realType").val("1");
				}else if(thePrex == "fld"){
					$("#showType").text("频道");
					$("#realType").val("2");
				}else{
					$("#showType").text("广告");
					$("#realType").val("3");
				}
				$("#showId").text(theId);
				
				var prevDates = $(this).parent().prev().text().replace(/-/g,"");
				/*自动选中相应日期？*/
				$('input[type="checkbox"][name="multipleDate"]').each(function() {
                    if(prevDates.indexOf($(this).val())!= -1){
                    	$(this).attr("checked",true);
                   	}
                });
				
				
				$( "#update_area" ).show();
				$( "#cover_body" ).css({width:$(document).width(),height:$(document).height()}).show();
				
			});	
			/*save*/
			$("#update_save").click(function(){
				
				/*是否有选择任意一个选择框*/
				var checkedValue="";
				$('input[type="checkbox"][name="multipleDate"]:checked').each(function() {
                    checkedValue = checkedValue + $(this).val()+",";
                });
				
				var ok = true;
				if(checkedValue == ""){
					$("#updateErrorInfo").text("请选择至少一个日期！");
					ok = false;
				}
				
				//查找原日期，如果两者一样，不做更新
				var prexArr = ["","prd","fld","adv"];
				var theBtn = "#"+prexArr[Number($("#realType").val())]+$("#showId").text();
				var oldDateArr = $(theBtn).parent().prev().text().replace(/-/g,"").split("\n");
				var oldDateStr = "";
				var formalOldDate = "";
				
				var d = new Date();
				var today = "" + d.getFullYear();
				var month = d.getMonth() + 1;
				if(month &gt; 9){
					today = today + month;
				}else {
					today = today + "0"+ month;
				}
				
				if(d.getDate() &gt; 9){
					today = today + d.getDate();
				}else {
					today = today + "0" + d.getDate();
				}
				
				$.each(oldDateArr,function(n,value) { 
					value = value.trim();
					if(value!=""){//只比较今天之后的日期
						formalOldDate = formalOldDate + value + ",";
						if(value &gt; today){
		            		oldDateStr = oldDateStr + value + ","; 
						}
					}
		        }); 
				
				if(checkedValue == oldDateStr){
					$("#updateErrorInfo").text("所选日期与原有日期完全相同！");
					ok = false;
				}
				
				if(ok){
					$("#updateErrorInfo").text("");
					//alert("${pageContext.request.contextPath}/domain/recommandcontainer/changeDate?newDates=" + checkedValue +"&amp;oldDates="+oldDateStr+"&amp;prd="+$("#showId").text()+"&amp;type="+$("#realType").val()+"&amp;containerId=${recommandContainer.primaryKey}");
					$.ajax( {
						type : "GET",
						url : "${pageContext.request.contextPath}/domain/recommandcontainer/changeDate?newDates=" + checkedValue +"&amp;oldDates="+formalOldDate+"&amp;prd="+$("#showId").text()+"&amp;type="+$("#realType").val()+"&amp;containerId=${recommandContainer.primaryKey}",
						success : function(ss) {
							if(ss){
								window.document.location.href="${pageContext.request.contextPath}/domain/recommandcontainer/showproducttask/${recommandContainer.primaryKey}?showby=1";
							}else{
								$("#updateErrorInfo").text("更新失败，可能原因是：1）参数不完整 2）其它错误，请检查！");
							}
						}
					});
				}
			});
			
			/*save*/
			$("#sort_save").click(function(){
				var productIdrs = $("#sortable").sortable('toArray');
				//alert(productIdrs);
				$.ajax( {
					type : "GET",
					url : "${pageContext.request.contextPath}/domain/recommandcontainer/sortTask?productContainers=" + productIdrs,
					success : function(ss) {
						if(ss){
							window.document.location.href="${pageContext.request.contextPath}/domain/recommandcontainer/showproducttask/${recommandContainer.primaryKey}";
						}else{
							
						}
					}
				})
			});
			/*save for add new */
			$("#add_save").click(function(){
				
				
				var productIds = $("#productIds").val();
				var ok = true;
				if(productIds == ""){
					$("#errorInfo").text("产品ID不能为空！");
					ok = false;
				}else {
					
					productIds = productIds.replace(/，/g,",");
					var prdArrays = productIds.split(",");
					for(var i=0;i &lt; prdArrays.length;i++){
						if(isNaN(prdArrays[i])){
							$("#errorInfo").text(prdArrays[i]+"不是数字！");
							ok = false;
							break;
						}
					}
				}
				
				if(ok){
					$("#errorInfo").text("");
					$.ajax( {
						type : "GET",
						url : "${pageContext.request.contextPath}/domain/recommandcontainer/addproducttaskwithoutdate?productIds=" + productIds + "&amp;onedate="+$("#addCurrDate").val()+"&amp;containerId=${recommandContainer.primaryKey}&amp;type="+$('[name="add_type"][checked=true]:radio').val(),
						success : function(ss) {
							if(ss){
								window.document.location.href="${pageContext.request.contextPath}/domain/recommandcontainer/showproducttask/${recommandContainer.primaryKey}";
							}else{
								$("#errorInfo").text("添加失败，可能原因是：1）找不到该产品 2）该产品在当天已经添加过 3）其它错误，请检查！");
							}
						}
					})
				}
			});
			
			/*cancel*/
			$("#sort_cancel").click(function(){
				$( "#sort_area" ).hide();
				$( "#cover_body" ).hide();
			});
			
			/*cancel*/
			$("#update_cancel").click(function(){
				
				/*全部置为不选状态*/
				$('input[type="checkbox"][name="multipleDate"]').each(function() {
                    $(this).attr("checked",false);
                });
				$("#updateErrorInfo").text("");
				
				$( "#update_area" ).hide();
				$( "#cover_body" ).hide();
			});

			/*cancel*/
			$("#add_cancel").click(function(){
				//清除
				$("#errorInfo").text("");
				$("#productIds").val("");
				
				$( "#add_area" ).hide();
				$( "#cover_body" ).hide();
			});

			/*move*/
			$( "#sortable" ).sortable();
			$( "#sortable" ).sortable('option', 'axis', 'y');
			$( "#sortable" ).sortable('option', 'opacity', 0.5);
			$( "#sortable" ).sortable('option', 'revert', true);
			$( "#sortable" ).sortable('option', 'items', 'li');
			
		});
		function copydate_check(){			
			var return_val = false;
			
			var disStrings = $("#disStrings").val();
			var copydate = $("#copydate").val();
			var disToday = $("#disToday").val();
			
			copydate = copydate.replace('-','').replace('-','');
			
			if(disStrings == ""){
				return_val = true;
			} else if(copydate &lt;= disToday) {
				$("#copyerrorInfo").text("不可以复制到已过日期！");
				return_val = false;
			} else if(disStrings.indexOf(copydate) >= 0){
				$("#copyerrorInfo").text("该日期已存在定时产品！");
				return_val = false;
			} else {
				return_val = true;
			}
			
			if(return_val){
				$("#copyerrorInfo").text(" ");
			}
			
			return return_val;
		}
	</script>
	<STYLE>
		#sortable { list-style-type: decimal; margin: 0px 0px 0px 12px; padding: 0; width: 100%; }
		#sortable li { cursor: move; margin: 0 1px 1px 12px; padding : 0.1em 0.4em 0.5em 1.0em; font-size: 1.0em; height: 16px; border: 1px solid #AAAAAA; border-radius: 4px 4px 4px 4px;}
	</STYLE>
</head>
<body>

	<a href="${pageContext.request.contextPath}/domain/recommandcontainer/search" class="ajaxy button button-search"><spring:message code="recommandContainer" /></a>
	<a href="${pageContext.request.contextPath}/domain/recommandcontainer/show/${recommandContainer.primaryKey}" class="ajaxy button button-show"><spring:message code="crud.show.button" /></a>
	<span class="ui-state-highlight button button-show"><spring:message code="productContainerTask" /></span>
	<a href="${pageContext.request.contextPath}/domain/recommandcontainer/addproduct?containerId=${recommandContainer.primaryKey}" class="ajaxy button button-create"><spring:message code="recommandContainer_add" /></a>

	<table class="show">
		<tbody>
			<tr>
				<th><spring:message code="recommandContainer_name" /></th>
				<td><spring:eval expression="recommandContainer.name"/></td>
				<th><spring:message code="recommandContainer_containerId" /></th>
				<td><spring:eval expression="recommandContainer.containerId"/></td>
			</tr>
			<tr>
				<th><spring:message code="recommandContainer_description" /></th>
				<td><spring:eval expression="recommandContainer.description"/></td>
				<th><spring:message code="recommandContainer_status" /></th>
				<c:if test="${recommandContainer.status == 0}"><td><spring:message code="recommandContainer_status_yes" /></td></c:if>
				<c:if test="${recommandContainer.status == 1}"><td><spring:message code="recommandContainer_status_no" /></td></c:if>
			</tr>
		</tbody>
	</table>

	<!-- 基于推荐位的定时产品添加操作 -->
	<span class="ui-state-highlight button button-show"><spring:message code="recommandContainer_product" /></span>
	<a href="${pageContext.request.contextPath}/domain/recommandcontainer/addproducttask?containerId=${recommandContainer.primaryKey}" class="ajaxy button button-create">
		<spring:message code="recommandContainer_add" />
	</a>

	<!-- show by displayDate -->
	<c:if test="${showby == 0}">
		<c:choose>
			<c:when test="${!empty productContainerTaskMap}">
				<span class="ui-state-highlight button button-show"><spring:message code="productContainerTask_showby_displayDate" /></span>
				<a href="${pageContext.request.contextPath}/domain/recommandcontainer/showproducttask/${recommandContainer.primaryKey}?showby=1" class="ajaxy button button-show">
					<spring:message code="productContainerTask_showby_product" />
				</a>
				<a href="${pageContext.request.contextPath}/domain/recommandcontainer/showproducttask/history/${recommandContainer.primaryKey}" class="ajaxy button button-show">
					<spring:message code="productContainerTask_history" />
				</a>
				<table class="edit">
					<thead>
						<tr>
						    <th style="width:5%">NO.</th>
							<th style="width:10%"><spring:message code="productList_productId" /></th>
							<th style="width:25%"><spring:message code="productList_name" /></th>
							<th style="width:10%"><spring:message code="productContainerTask_type" /></th>
							<th style="width:10%"><spring:message code="productContainerTask_status" /></th>
							<th style="width:5%"><spring:message code="productContainerTask_productContainerId" /></th>
							<th style="width:10%"><spring:message code="productContainer_modBy" /></th>
							<th style="width:15%"><spring:message code="productContainer_modDate" /></th>
							<th style="width:10%"><spring:message code="productContainer_operation" /></th>
						</tr>
					</thead>
					<tbody>
						<!-- 关于天的循环 -->
						<c:forEach items="${productContainerTaskMap}" var="map" varStatus="status">
							<tr><!-- 以下为该天的数据 -->
								<td colspan="9">
									<table width="100%" id="tb${map.key}">
										<tr style="height:1px">
											<th style="width:5%"></th>
											<th style="width:10%"></th>
											<th style="width:25%"></th>
											<th style="width:10%"></th>
											<th style="width:10%"></th>
											<th style="width:5%"></th>
											<th style="width:10%"></th>
											<th style="width:15%"></th>
											<th style="width:10%"></th>
										</tr>
										<tr>
											<td colspan="5" style="text-align:center">
												<fmt:parseDate value="${map.key}" type="date" var="date_date" pattern="yyyyMMdd"/>
												<fmt:formatDate value="${date_date}" type="date" pattern="yyyy年MM月dd日"/>&amp;nbsp;&amp;nbsp;
												<a href="${pageContext.request.contextPath}/domain/productcontainertask/copydate/${recommandContainer.primaryKey}/${map.key}/" class="button modal miniature"><spring:message code="productContainerTask_copydate"/></a>
											</td>
											<td colspan="4">
												<!-- 排序和添加的操作 -->
												<a id="sort${map.key}" href="#" class="ajaxy button sortclass"><spring:message code="crud.sort.button" /></a>
												&amp;nbsp;&amp;nbsp;
												<a id="add${map.key}" href="#" class="ajaxy button addclass"><spring:message code="recommandContainer_add" /></a>
												&amp;nbsp;&amp;nbsp;
												<a href="${pageContext.request.contextPath}/domain/productcontainertask/deletebydate/${recommandContainer.primaryKey}/${map.key}/" class="button modal miniature"><spring:message code="crud.clear.button"/></a>
												<c:if test="${showType == 1 &amp;&amp; map.key == today}">
													&amp;nbsp;&amp;nbsp;
													<a href="${pageContext.request.contextPath}/domain/init/redis/productContainer/task/${recommandContainer.primaryKey}/${map.key}/" class="modal button button"><spring:message code="crud.redis.publish.button"/></a>
												</c:if>
											</td>
										</tr>
										<c:set value="" var="idList" />
										<c:forEach items="${map.value}" var="productContainerTask" varStatus="status">
											<tr>
												<c:if test="${productContainerTask.type==1}">
													<td>
														${status.index+1}
													</td>
													<td>
														${productContainerTask.product.productId}
														<c:choose>
															<c:when test="${idList != ''}">
														    	<c:set value="${idList},${productContainerTask.product.productId}" var="idList" />
															</c:when>
															<c:otherwise>
															    <c:set value="${productContainerTask.product.productId}" var="idList" />
															</c:otherwise>
														</c:choose>
													</td>
													<td>
														<a href="${pageContext.request.contextPath}/domain/productlist/show/${productContainerTask.product.productId}">${productContainerTask.product.name}</a>
													</td>
													<td>
														<spring:message code="productContainerTask_type_Product" />
													</td>
													<td>
														<c:if test="${productContainerTask.product.downStatus==0}"><spring:message code="productList_status_enable" /></c:if>
														<c:if test="${productContainerTask.product.downStatus==1}"><font color="red"><spring:message code="productList_status_disable" /></font></c:if>
													</td>
												</c:if>
												<c:if test="${productContainerTask.type==2}">
													<td>
														${status.index+1}
													</td>
													<td>
														${productContainerTask.tfolder.folderId}
													</td>
													<td>
														<a href="${pageContext.request.contextPath}/domain/folder/show/${productContainerTask.tfolder.folderId}">${productContainerTask.tfolder.name}</a>
													</td>
													<td>
														<spring:message code="productContainerTask_type_Folder" />
													</td>
													<td>
														<c:if test="${productContainerTask.tfolder.status==0}"><spring:message code="folder_status_yes" /></c:if>
														<c:if test="${productContainerTask.tfolder.status==1}"><font color="red"><spring:message code="folder_status_no" /></font></c:if>
													</td>
												</c:if>
												<c:if test="${productContainerTask.type==3}">
													<td>
														${status.index+1}
													</td>
													<td>
														${productContainerTask.advertise.advertiseId}
													</td>
													<td>
														<a href="${pageContext.request.contextPath}/domain/advertise/show/${productContainerTask.advertise.advertiseId}">${productContainerTask.advertise.name}</a>
													</td>
													<td>
														<spring:message code="productContainerTask_type_Advertise" />
													</td>
													<td>
														<c:if test="${productContainerTask.advertise.status==0}"><spring:message code="advertise_status_enable" /></c:if>
														<c:if test="${productContainerTask.advertise.status==1}"><font color="red"><spring:message code="advertise_status_disable" /></font></c:if>
													</td>
												</c:if>
												<td>
													${productContainerTask.productContainerTaskId}
												</td>
												<td>
													${productContainerTask.modBy}
												</td>
												<td>
													<fmt:formatDate value="${productContainerTask.modDate}" type="date" pattern="yyyy-MM-dd"/>
												</td>
												<td>
													<a href="${pageContext.request.contextPath}/domain/productcontainertask/delete/${productContainerTask.primaryKey}" class="button button-delete modal miniature"><spring:message code="crud.delete.button"/></a>
												</td>
											</tr>
										</c:forEach>
										<tr><td colspan="9" style="word-break:break-all">ID排序（仅限于产品）：${idList}</td></tr>
									</table><!-- 以上为该天数据 -->
								</td>
							</tr>
						</c:forEach>
						<!-- 天的循环 -->
					</tbody>
				</table>
				
				<!-- sort -->
				<div id="sort_area" class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable ui-resizable" style="display: none; z-index: 1002; outline: 0px none; position: absolute; height: auto; width: 300px; top: 120px; left: 478px;">
					<div class="ui-dialog-content" style="width: auto; min-height: 102.267px; height: auto;">
						<div>
							<ul id="sortable">
								<li>nothing</li>
							</ul>
						</div>
						<div style="padding-left: 5.5em;">
							<spring:message code="crud.save.button" var="saveButton"/>
							<input id="sort_save" type="button" class="button" value="${saveButton}"/>
							<spring:message code="crud.cancel.button" var="sortButton"/>
							<input id="sort_cancel" type="button" class="button" value="${sortButton}"/>
						</div>
					</div>
				</div>
				<!-- add_new -->
				<div id="add_area" class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable ui-resizable" style="display: none; z-index: 1002; outline: 0px none; position: absolute; height: auto; width: 500px; top: 220px; left: 378px;">
					<div class="ui-dialog-content" style="width: auto; min-height: 102.267px; height: auto;">
						<div>
							<table style="width:100%">
								<tbody>
									<!--产品类型-->
									<tr>
										<th style="width:25%">
											<spring:message code="productContainerTask_type" />
										</th>
										<td>
											<input type="radio" name="add_type" value="1" checked="checked"/><spring:message code="productContainerTask_type_Product" />
											<input type="radio" name="add_type" value="2" /><spring:message code="productContainerTask_type_Folder" />
											<input type="radio" name="add_type" value="3" /><spring:message code="productContainerTask_type_Advertise" />
										</td>
									</tr>
									<tr>
										<th>
											<spring:message code="productContainerTask_Id" />
										</th>
										<td>
											<input type="text" id="productIds" name="productIds" class="required {maxlength: 200}" maxlength="200"  size="50" value="${product}"/>
											<br/><span>提示：多个ID值请使用“,”或“，”来分隔</span>
											<input type="hidden" id="addCurrDate" value="" />
										</td>
									</tr>
									<tr>
										<th>
											<spring:message code="productContainerTask_displayDate" />
										</th>
										<td><span id="showDate">nothing</span></td>
									</tr>
								</tbody>
							</table>
							<span style="color:red" id="errorInfo">&amp;nbsp;</span><br/>
						</div>
						<div style="text-align:center;">
							<spring:message code="crud.save.button" var="saveButton"/>
							<input id="add_save" type="button" class="button" value="${saveButton}"/>
							&amp;nbsp;&amp;nbsp;
							<spring:message code="crud.cancel.button" var="sortButton"/>
							<input id="add_cancel" type="button" class="button" value="${sortButton}"/>
						</div>
					</div>
				</div>
				<!-- end -->
			</c:when>
			<c:otherwise>
				<table class="show"><tbody><tr><td><spring:message code="productContainerTask_none" /></td></tr></tbody></table>
			</c:otherwise>
		</c:choose>
	</c:if>
	<!-- show by product -->
	<c:if test="${showby == 1}">
		<c:choose>
			<c:when test="${!empty productTaskMap || !empty folderTaskMap || !empty advertiseTaskMap}">
				<!-- 切换显示方式 -->
				<a href="${pageContext.request.contextPath}/domain/recommandcontainer/showproducttask/${recommandContainer.primaryKey}?showby=0" class="ajaxy button button-show">
					<spring:message code="productContainerTask_showby_displayDate" />
				</a>
				<span class="ui-state-highlight button button-show"><spring:message code="productContainerTask_showby_product" /></span>
				
				<!-- 显示内容 -->
				<table class="edit">
					<tbody>
						<tr>
							<th style="width:10%"><spring:message code="productContainerTask_Id" /></th><!-- ID -->
							<th style="width:25%"><spring:message code="productContainerTask_name" /></th><!-- Name -->
							<th style="width:10%"><spring:message code="productContainerTask_type" /></th><!-- Type -->
							<th><spring:message code="productContainerTask_status" /></th><!-- status -->
							<th style="width:30%"><spring:message code="productContainerTask_displayDate" /></th>
							<th style="width:15%"><spring:message code="productContainer_operation" /></th>
						</tr>
						<c:if test="${!empty productTaskMap}">
							<c:forEach items="${productTaskMap}" var="map" varStatus="status">
								<c:set value="${map.key}" var="productList" />
								<tr>
									<td>
										${productList.productId}
									</td>
									<td>
										<a href="${pageContext.request.contextPath}/domain/productlist/show/${productList.productId}">${productList.name}</a>
									</td>
									<td>
										<spring:message code="productContainerTask_type_Product" />
									</td>
									<td>
										<c:if test="${productList.downStatus==0}"><spring:message code="productList_status_enable" /></c:if>
										<c:if test="${productList.downStatus==1}"><font color="red"><spring:message code="productList_status_disable" /></font></c:if>
									</td>
									<td>
										<c:forEach items="${map.value}" var="displaydates" varStatus="status2">
											<fmt:parseDate value="${displaydates}" type="date" var="date_date2" pattern="yyyyMMdd"/>
											<fmt:formatDate value="${date_date2}" type="date" pattern="yyyy-MM-dd"/>
											&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
											<c:if test="${(status2.index+1)%3 == 0}"><br/></c:if>
										</c:forEach>
									</td>
									<td>
										<a id="prd${productList.productId}" href="#" class="ajaxy button updateclass"><spring:message code="crud.edit.button" /></a>
									</td>
								</tr>
							</c:forEach>
						</c:if>
						<c:if test="${!empty folderTaskMap}">
							<c:forEach items="${folderTaskMap}" var="map" varStatus="status">
								<c:set value="${map.key}" var="tfolder" />
								<tr>
									<td>
										${tfolder.folderId}
									</td>
									<td>
										<a href="${pageContext.request.contextPath}/domain/folder/show/${tfolder.folderId}">${tfolder.name}</a>
									</td>
									<td>
										<spring:message code="productContainerTask_type_Folder" />
									</td>
									<td>
										<c:if test="${tfolder.status==0}"><spring:message code="folder_status_yes" /></c:if>
										<c:if test="${tfolder.status==1}"><font color="red"><spring:message code="folder_status_no" /></font></c:if>
									</td>
									<td>
										<c:forEach items="${map.value}" var="displaydates" varStatus="status2">
											<fmt:parseDate value="${displaydates}" type="date" var="date_date2" pattern="yyyyMMdd"/>
											<fmt:formatDate value="${date_date2}" type="date" pattern="yyyy-MM-dd"/>
											&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
											<c:if test="${(status2.index+1)%3 == 0}"><br/></c:if>
										</c:forEach>
									</td>
									<td>
										<a id="fld${tfolder.folderId}" href="#" class="ajaxy button updateclass"><spring:message code="crud.edit.button" /></a>
									</td>
								</tr>
							</c:forEach>
						</c:if>
						<c:if test="${!empty advertiseTaskMap}">
							<c:forEach items="${advertiseTaskMap}" var="map" varStatus="status">
								<c:set value="${map.key}" var="advertise" />
								<tr>
									<td>
										${advertise.advertiseId}
									</td>
									<td>
										<a href="${pageContext.request.contextPath}/domain/advertise/show/${advertise.advertiseId}">${advertise.name}</a>
									</td>
									<td>
										<spring:message code="productContainerTask_type_Advertise" />
									</td>
									<td>
										<c:if test="${advertise.status==0}"><spring:message code="advertise_status_enable" /></c:if>
										<c:if test="${advertise.status==1}"><font color="red"><spring:message code="advertise_status_disable" /></font></c:if>
									</td>
									<td>
										<c:forEach items="${map.value}" var="displaydates" varStatus="status2">
											<fmt:parseDate value="${displaydates}" type="date" var="date_date2" pattern="yyyyMMdd"/>
											<fmt:formatDate value="${date_date2}" type="date" pattern="yyyy-MM-dd"/>
											&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
											<c:if test="${(status2.index+1)%3 == 0}"><br/></c:if>
										</c:forEach>
									</td>
									<td>
										<a id="adv${advertise.advertiseId}" href="#" class="ajaxy button updateclass"><spring:message code="crud.edit.button" /></a>
									</td>
								</tr>
							</c:forEach>
						</c:if>
					</tbody>
				</table>
				
				<!-- update area -->
				<div id="update_area" class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable ui-resizable" style="display: none; z-index: 1002; outline: 0px none; position: absolute; height: auto; width: 500px; top: 220px; left: 378px;">
					<div class="ui-dialog-content" style="width: auto; min-height: 102.267px; height: auto;">
						<div>
							<table style="width:100%">
								<tbody>
									<!--产品类型-->
									<tr>
										<th style="width:25%">
											<spring:message code="productContainerTask_type" />
										</th>
										<td><span id="showType">&amp;nbsp;</span><input type="hidden" id="realType" value="" /></td>
									</tr>
									<tr>
										<th>
											<spring:message code="productContainerTask_Id" />
										</th>
										<td>
											<span id="showId"></span>
										</td>
									</tr>
									<tr>
										<th>
											<spring:message code="productContainerTask_displayDate" />
										</th>
										<td>
											<c:if test="${!empty dates}">
												<c:forEach items="${dates}" var="date" varStatus="status">
													<input type="checkbox" name="multipleDate" value="${date}" />
													<fmt:parseDate value="${date}" type="date" var="date_date" pattern="yyyyMMdd"/>
													<fmt:formatDate value="${date_date}" type="date" pattern="yyyy-MM-dd"/>
													
													<c:if test="${(status.index+1)%3==0 }">
														<br/>
													</c:if>
												</c:forEach>
											</c:if>
										</td>
									</tr>
								</tbody>
							</table>
							<span style="color:red" id="updateErrorInfo">&amp;nbsp;</span><br/>
						</div>
						<div style="text-align:center;">
							<spring:message code="crud.save.button" var="saveButton"/>
							<input id="update_save" type="button" class="button" value="${saveButton}"/>
							&amp;nbsp;&amp;nbsp;
							<spring:message code="crud.cancel.button" var="sortButton"/>
							<input id="update_cancel" type="button" class="button" value="${sortButton}"/>
						</div>
					</div>
				</div>
				<!-- end -->				
				
			</c:when>
			<c:otherwise>
				<table class="show"><tbody><tr><td><spring:message code="productContainerTask_none" /></td></tr></tbody></table>
			</c:otherwise>
		</c:choose>
	</c:if>
	<!-- show by product end-->
	<div id="cover_body" class="ui-widget-overlay" style="display:none; z-index: 1001;"></div>
	
</body>
</html>