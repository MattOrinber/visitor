<html xmlns:util="urn:jsptagdir:/WEB-INF/tags/util" xmlns:jsp="http://java.sun.com/JSP/Page" 
xmlns:decorator="http://www.opensymphony.com/sitemesh/decorator" xmlns:c="http://java.sun.com/jsp/jstl/core" 
xmlns:form="http://www.springframework.org/tags/form" xmlns:security="http://www.springframework.org/security/tags" 
xmlns:spring="http://www.springframework.org/tags" version="2.0">
<jsp:output omit-xml-declaration="yes" />
<jsp:directive.page contentType="text/html; charset=UTF-8" />
<head>
	<title><spring:message code="folder" />: <spring:message code="crud.functionalities.create" /></title>
	<script type="text/javascript">
	
	function check(){
		if($("#siteId").val()==""){
			alert("请选择站点！");
			return false;
		}
		
		return true;
	}
</script>
</head>
<body>
	<a href="${pageContext.request.contextPath}/domain/folder/search" class="ajaxy button button-search"><spring:message code="folder" /></a>
	<span class="ui-state-highlight button button-create"><spring:message code="crud.functionalities.create" /></span>
	<a href="${pageContext.request.contextPath}/domain/folder/tree" class="button"><spring:message code="folder_site_nodes" /></a>
	<form:form action="${pageContext.request.contextPath}/domain/folder/create" modelAttribute="folder" method="POST" onsubmit="return check()">
		<form:errors cssClass="error"/>
		<form:hidden path="folderId"/>
		<table class="create">
			<tbody>
				<form:hidden path="siteId" value="${sessionScope.siteId}" />
				<tr>
					<th><spring:message code="folder_parentFolderId" /></th>
					<td>
						<c:choose>
							<c:when test="${folder.parentFolder != null}">
								<input type="hidden" name="parentFolderId" value="${folder.parentFolder.folderId}" />
								${folder.parentFolder.name}
							</c:when>
							<c:otherwise>
								<form:select path="parentFolderId">
									<form:option value=""><spring:message code="button_select" /></form:option>
									<form:options items="${folderList}" itemValue="value" itemLabel="label" />
								</form:select>
							</c:otherwise>
						</c:choose>
						<form:errors path="parentFolderId" cssClass="error"/>
					</td>
				</tr>
				<tr>
					<th><spring:message code="folder_name" /> <em>*</em></th>
					<td>
						<form:input path="name" cssClass="required {maxlength: 200}" maxlength="200" size="80"/>
						<form:errors path="name" cssClass="error"/>
					</td>
				</tr>
				<tr>
					<th><spring:message code="folder_aliasName" /><em>*</em></th>
					<td>
						<form:input path="aliasName" cssClass="required {maxlength: 200}" maxlength="200" size="80"/>
						<form:errors path="aliasName" cssClass="error"/>
					</td>
				</tr>
				<tr>
					<th><spring:message code="folder_description" /></th>
					<td>
						<form:input path="description" cssClass="{maxlength: 254}" maxlength="254" size="80"/>
						<form:errors path="description" cssClass="error"/>
					</td>
				</tr>
				<tr>
					<th><spring:message code="folder_picId" /></th>
					<td>
						<div id="folder_pic" style="display:none;"><img src="/" height="36" width="36" /></div>
						<spring:eval expression="folder.picId" javaScriptEscape="true" var="picName"/>
						<input type="hidden" id="pic" name="picId" value="${picName}" />
						<input type="text" id="picLabel" value="${folder.pic.name}" size="60" />
						<script>
						$(function() {
							$("#picLabel").autocomplete('destroy');
							$("#picLabel").autocomplete({
								source: "${pageContext.request.contextPath}/domain/picture/autocomplete/1",
								select: function(event, ui) {
									$("#pic").val(ui.item.id);
									$("#picLabel").val(ui.item.label);
									var path = ui.item.label;
									path = "/" +path.substring(path.indexOf('/'));
									$("#folder_pic").show().children().attr("src","${picDomain}"+path);
								}
							});
						});
						</script>
						<form:errors path="picId" cssClass="error"/>
					</td>
				</tr>
				<tr>
					<th>
						<spring:message code="folder_miniLab" />
					</th>
					<td>
						<form:select path="miniLab">
							<form:option value=""><spring:message code="NULL" /></form:option>
							<form:option value="1"><spring:message code="folder_miniLab_hot" /></form:option>
							<form:option value="2"><spring:message code="folder_miniLab_new" /></form:option>
							<form:option value="3"><spring:message code="folder_miniLab_olm" /></form:option>
							<form:option value="4"><spring:message code="folder_miniLab_4" /></form:option>
							<form:option value="5"><spring:message code="folder_miniLab_5" /></form:option>
						</form:select>
						<form:errors path="miniLab" cssClass="error" />
					</td>
				</tr>
				<tr>
					<th>
						<spring:message code="folder_safeType" />
						<em>*</em>
					</th>
					<td>
						<form:select path="safeType" items="${safeTypeList}" itemValue="value" itemLabel="name" />
						<form:errors path="safeType" cssClass="error" />
					</td>
				</tr>				
			</tbody>
			<tfoot>
				<tr>
					<td colspan="2">
						<spring:message code="crud.save.button" var="buttonValue"/>
						<input type="submit" class="button button-save" value="${buttonValue}"/>
					</td>
				</tr>
			</tfoot>
		</table>
	</form:form>
</body>
</html>